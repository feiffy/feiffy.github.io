import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e as t}from"./app.6f7e30ef.js";const p={},e=t(`<ul><li><p>Codeignitor \u7684 db \u7C7B\u7684\u8BF4\u660E\uFF0C\u953B\u70BC\u4E00\u4E0B\u6587\u5B57\u8868\u8FBE\u80FD\u529B</p></li><li><p>\u4E00\u822C\u7684\u4F7F\u7528\u573A\u666F\uFF1A</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">home</span> <span class="token keyword">extends</span> <span class="token class-name">Base_Controller</span>
<span class="token punctuation">{</span>    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">load</span><span class="token operator">-&gt;</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;my/User_model&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">User_model</span> extend CI_Model  
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>
       <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">load</span><span class="token operator">-&gt;</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;my&#39;</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token function">get_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token variable">$key</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u5728 controller \u4E2D\u52A0\u8F7D model \u7C7B</p></li><li><p>\u5728 model \u4E2D\u52A0\u8F7D db\uFF0C\u83B7\u5F97 db \u5BF9\u8C61\uFF0C\u53EF\u4EE5\u7528\u6765\u67E5\u8BE2 sql</p><ul><li>model \u4E2D\u7684 load \u5BF9\u8C61\u662F\u4ECE controller \u4E2D\u83B7\u53D6\u7684</li><li>db \u5BF9\u8C61\u7684\u7C7B\u578B\u662F <code>CI_DB_mysqli_driver</code>\uFF0C\u8FD9\u662F load \u5BF9\u8C61\u6839\u636E\u9ED8\u8BA4\u914D\u7F6E\u521B\u5EFA\u7684 mysql \u6570\u636E\u5E93\u67E5\u8BE2\u5BF9\u8C61</li><li>\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\u5728 <code>/config/database.php</code>\uFF0C\u6309\u7167\u6846\u67B6\u7EA6\u5B9A\u914D\u7F6E\u597D\u6570\u636E\u5E93\u53C2\u6570</li></ul></li><li><p>database.php \u5185\u5BB9\u5982\u4E0B\uFF1A</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$active_group</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;default&#39;</span><span class="token punctuation">;</span>  
<span class="token variable">$query_builder</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>
<span class="token variable">$db</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;default&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token variable">$db</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;myche&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>  
         <span class="token string single-quoted-string">&#39;dsn&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;hostname&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;DB_MY_HOST&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;DB_MY_USER&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;password&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;DB_MY_PASS&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;DB_MY_NAME&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;dbdriver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;mysqli&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;dbprefix&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;pconnect&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;db_debug&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token constant">ENVIRONMENT</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">&#39;production&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;cache_on&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;cachedir&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;char_set&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;utf8&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;dbcollat&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;utf8_general_ci&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;swap_pre&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;encrypt&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;compress&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;stricton&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;failover&#39;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
         <span class="token string single-quoted-string">&#39;save_queries&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token constant">ENVIRONMENT</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">&#39;production&#39;</span><span class="token punctuation">)</span>  
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>CI_DB_mysqli_driver</code> \u7EE7\u627F\u81EA <code>CI_DB</code>\uFF0C<code>CI_DB</code> \u7C7B\u4F7F\u7528\u4E86\u4E00\u79CD\u5947\u602A\u7684\u65B9\u5F0F\u5B9E\u73B0\u7684\uFF0C\u8FD9\u4E2A\u7C7B\u662F\u5728\u4E00\u4E2A\u53EB\u505A<code>DB</code>\u7684\u51FD\u6570\u5185\u58F0\u660E\u7684\uFF0C\u6839\u636E <code>$query_builder=true</code> \u7684\u914D\u7F6E\u6765\u51B3\u5B9A\u58F0\u660E<code>CI_DB</code>\u7684\u7236\u7C7B\u662F<code>CI_DB_driver</code>\u8FD8\u662F<code>CI_DB_query_builder</code>\uFF0C\u4E24\u8005\u7684\u533A\u522B\u5C31\u662F\u540E\u8005\u7EE7\u627F\u81EA\u524D\u8005\u5E76\u5728\u524D\u8005\u7684\u57FA\u7840\u4E0A\u5B9E\u73B0\u4E86\u5E38\u7528\u8BED\u53E5\u7684\u94FE\u5F0F\u8C03\u7528\u65B9\u6CD5\u3002\u6309\u7167\u58F0\u660E\u5904\u6CE8\u91CA\u6240\u8BF4\uFF0C<code>CI_DB</code>\u7C7B\u53EF\u4EE5\u7406\u89E3\u4E3A <code>CI_DB_driver</code> \u548C <code>CI_DB_query_builder</code> \u7684\u522B\u540D\u3002</p></li><li><p><code>CI_DB_mysqli_driver</code>\u7684\u521B\u5EFA\u8FC7\u7A0B\uFF1A</p><ul><li>\u5728 load \u5BF9\u8C61\u7684 database \u65B9\u6CD5\u4E2D\u8C03\u7528 DB \u51FD\u6570</li><li>\u5728 DB \u51FD\u6570\u4E2D <ul><li>\u58F0\u660E <code>CI_DB</code>\uFF0C\u6839\u636E <code>$query_builder=true</code> \u7684\u914D\u7F6E\u6765\u51B3\u5B9A<code>CI_DB</code>\u7684\u7236\u7C7B\u662F<code>CI_DB_driver</code>\u8FD8\u662F<code>CI_DB_query_builder</code>\u3002</li><li>\u6839\u636E <code>dbdriver</code> \u914D\u7F6E\u52A0\u8F7D\u6570\u636E\u5E93\u9A71\u52A8\u7C7B\u6587\u4EF6\uFF0C\u5E76\u5B9E\u4F8B\u5316 <code>CI_DB_mysqli_driver</code>\uFF0C\u5E76\u8FD4\u56DE\u6B64\u5BF9\u8C61\u3002</li></ul></li></ul></li><li><p>DB \u51FD\u6570\u7684\u5B9E\u73B0</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token operator">&amp;</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token variable">$query_builder_override</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>  
<span class="token punctuation">{</span>
    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token constant">BASEPATH</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;database/DB_driver.php&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$query_builder</span><span class="token punctuation">)</span> <span class="token keyword">OR</span> <span class="token variable">$query_builder</span> <span class="token operator">===</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token constant">BASEPATH</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;database/DB_query_builder.php&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;CI_DB&#39;</span><span class="token punctuation">,</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token doc-comment comment">/**
			 * CI_DB
			 *
			 * Acts as an alias for both CI_DB_driver and CI_DB_query_builder.
			 *
			 * <span class="token keyword">@see</span>	CI_DB_query_builder
			 * <span class="token keyword">@see</span>	CI_DB_driver
			 */</span>
			<span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_DB</span> <span class="token keyword">extends</span> <span class="token class-name">CI_DB_query_builder</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">elseif</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;CI_DB&#39;</span><span class="token punctuation">,</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_DB</span> <span class="token keyword">extends</span> <span class="token class-name">CI_DB_driver</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    
    <span class="token comment">// Load the DB driver  </span>
    <span class="token variable">$driver_file</span> <span class="token operator">=</span> <span class="token constant">BASEPATH</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;database/drivers/&#39;</span><span class="token operator">.</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dbdriver&#39;</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;/&#39;</span><span class="token operator">.</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dbdriver&#39;</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;_driver.php&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token variable">$driver_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Instantiate the DB adapter</span>
	<span class="token variable">$driver</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;CI_DB_&#39;</span><span class="token operator">.</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dbdriver&#39;</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;_driver&#39;</span><span class="token punctuation">;</span>
	<span class="token variable">$DB</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$driver</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token variable">$DB</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>CI_DB_mysqli_driver</code> \u6700\u7EC8\u662F\u7EE7\u627F\u81EA <code>CI_DB_driver</code> \u8FD9\u4E2A\u62BD\u8C61\u7C7B\u3002<code>CI_DB_driver</code> \u5B9A\u4E49\u4E86\u6570\u636E\u5E93\u9A71\u52A8\u7C7B\u9700\u8981\u5B9E\u73B0\u7684\u4E00\u4E9B\u901A\u7528\u65B9\u6CD5\uFF0C\u5177\u4F53\u7684\u9A71\u52A8\u7C7B\u6BD4\u5982 <code>CI_DB_mysqli_driver</code> \u5219\u5B9E\u73B0\u4E86\u8FD9\u4E9B\u65B9\u6CD5\u3002</p></li><li><p><code>CI_DB_driver</code> \u5173\u952E\u65B9\u6CD5\u5B9A\u4E49</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_DB_driver</span> <span class="token punctuation">{</span>
    <span class="token comment">// db \u8FDE\u63A5</span>
    <span class="token keyword">function</span> <span class="token function-definition function">db_connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
    <span class="token comment">// db \u957F\u8FDE\u63A5</span>
    <span class="token keyword">function</span> <span class="token function-definition function">db_pconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u8BBE\u7F6E\u8FDE\u63A5\u5B57\u7B26\u96C6\u7F16\u7801</span>
    <span class="token keyword">function</span> <span class="token function-definition function">_db_set_charset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u9009\u62E9\u6570\u636E\u5E93</span>
    <span class="token keyword">function</span> <span class="token function-definition function">db_select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u5F00\u59CB\u4E8B\u52A1</span>
    <span class="token keyword">function</span> <span class="token function-definition function">_trans_begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u56DE\u6EDA\u4E8B\u52A1</span>
    <span class="token keyword">function</span> <span class="token function-definition function">_trans_rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u63D0\u4EA4\u4E8B\u52A1</span>
    <span class="token keyword">function</span> <span class="token function-definition function">_trans_commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// \u6267\u884C\u67E5\u8BE2</span>
    <span class="token keyword">function</span> <span class="token function-definition function">_execute</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>CI_DB_mysqli_driver</code> \u7684\u90E8\u5206\u5B9E\u73B0</li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_DB_mysqli_driver</span> <span class="token keyword">extends</span> <span class="token class-name">CI_DB</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8FDE\u63A5\u6570\u636E\u5E93</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">db_connect</span><span class="token punctuation">(</span><span class="token variable">$persistent</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>
        <span class="token comment">// Do we have a socket path?</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hostname</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token variable">$hostname</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
			<span class="token variable">$port</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
			<span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hostname</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token comment">// Persistent connection support was added in PHP 5.3.0</span>
			<span class="token variable">$hostname</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$persistent</span> <span class="token operator">===</span> <span class="token constant boolean">TRUE</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_php</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;5.3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token operator">?</span> <span class="token string single-quoted-string">&#39;p:&#39;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hostname</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hostname</span><span class="token punctuation">;</span>
			<span class="token variable">$port</span> <span class="token operator">=</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">port</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">NULL</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">port</span><span class="token punctuation">;</span>
			<span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token variable">$client_flags</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">compress</span> <span class="token operator">===</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MYSQLI_CLIENT_COMPRESS</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span> <span class="token operator">=</span> <span class="token function">mysqli_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token operator">-&gt;</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_OPT_CONNECT_TIMEOUT</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ... \u6B64\u5904\u7701\u7565\u4E00\u4E9B\u8BBE\u7F6E\u7684\u4EE3\u7801</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token operator">-&gt;</span><span class="token function">real_connect</span><span class="token punctuation">(</span><span class="token variable">$hostname</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">database</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token variable">$client_flags</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">// Prior to version 5.7.3, MySQL silently downgrades to an unencrypted connection if SSL setup fails</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>
				<span class="token punctuation">(</span><span class="token variable">$client_flags</span> <span class="token operator">&amp;</span> <span class="token constant">MYSQLI_CLIENT_SSL</span><span class="token punctuation">)</span>
				<span class="token operator">&amp;&amp;</span> <span class="token function">version_compare</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token operator">-&gt;</span><span class="token property">client_info</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;5.7.3&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&lt;=&#39;</span><span class="token punctuation">)</span>
				<span class="token operator">&amp;&amp;</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SHOW STATUS LIKE &#39;ssl_cipher&#39;&quot;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">fetch_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">Value</span><span class="token punctuation">)</span>
			<span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;MySQLi was configured for an SSL connection, but got an unencrypted connection instead!&#39;</span><span class="token punctuation">;</span>
				<span class="token function">log_message</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token property">db_debug</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token function">display_error</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name return-type">FALSE</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_mysqli</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u8FD9\u91CC <code>mysqli_init</code> \u51FD\u6570\u662F php \u6269\u5C55\u81EA\u5E26\u7684\u51FD\u6570\uFF0C\u8FD4\u56DE\u7684\u662F php \u7684 resource \u7C7B\u578B\u7684\u5BF9\u8C61\uFF0C\u5373 mysqli \u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u53EF\u4EE5\u7528\u6765\u67E5\u8BE2\u6570\u636E\u5E93\u3002</p></li><li><p>\u518D\u770B\u4E0B <code>CI_DB_query_builder</code> \u7684\u90E8\u5206\u5B9E\u73B0\uFF0C\u4E3B\u8981\u7684\u529F\u80FD\u662F\u57FA\u4E8E driver \u7684\u65B9\u6CD5\uFF0C\u5B9E\u73B0\u5F88\u591A\u4EBA\u6027\u5316\u7684\u3001\u53EF\u4EE5\u94FE\u5F0F\u8C03\u7528\u7684\u65B9\u6CD5\u3002</p></li></ul><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">CI_DB_query_builder</span> <span class="token keyword">extends</span> <span class="token class-name">CI_DB_driver</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">limit</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$offset</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token keyword">OR</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">qb_limit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
		<span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$offset</span><span class="token punctuation">)</span> <span class="token keyword">OR</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">qb_offset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$offset</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">offset</span><span class="token punctuation">(</span><span class="token variable">$offset</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$offset</span><span class="token punctuation">)</span> <span class="token keyword">OR</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">qb_offset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span> <span class="token variable">$offset</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$offset</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$table</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">_track_aliases</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">,</span> <span class="token variable">$offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">_compile_select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">_reset_select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function-definition function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">or_where</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">like</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">having</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),o=[e];function c(i,l){return s(),a("div",null,o)}const k=n(p,[["render",c],["__file","2022-03-30-codeignitor3-db-class.html.vue"]]);export{k as default};
